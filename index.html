<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

<script src="js/sprite.js"></script>


</head>
<body style="">
<canvas id='mycanvas' style="">
</canvas>


<script>
    const up_arrow = 38;
    const down_arrow = 40;
    const left_arrow = 37;
    const right_arrow = 39;

    const canvas = document.querySelector("canvas");
    const sprites_to_draw = new Array(3); 
    var draw_loop_timeout;
    var img = new Image();
    
    sprites_to_draw[0] = new Array(0); //background and 
    sprites_to_draw[1] = new Array(0); //forground
    sprites_to_draw[2] = new Array(0); //forground

    var key_change = false; 


    document.body.onkeydown = function(e){
    if(e.keyCode == up_arrow){
        sprites_to_draw[1][0].move(up_arrow)
    }else if(e.keyCode == right_arrow){
        sprites_to_draw[1][0].move(right_arrow)
    }else if(e.keyCode == down_arrow){
        sprites_to_draw[1][0].move(down_arrow)
    }else if(e.keyCode == left_arrow){
        sprites_to_draw[1][0].move(left_arrow)
    }

    if(e.keyCode == up_arrow){
        sprites_to_draw[0][0].move(up_arrow)
    }else if(e.keyCode == right_arrow){
        sprites_to_draw[0][0].move(right_arrow)
    }else if(e.keyCode == down_arrow){
        sprites_to_draw[0][0].move(down_arrow)
    }else if(e.keyCode == left_arrow){
        sprites_to_draw[0][0].move(left_arrow)
    }
    };

    

    $.getJSON( "Penguins/animationData.json", function( data ) {
        sprites_to_draw[0].push( new Sprite(data, 400 ,100, "idle") );
        //sprites_to_draw[0].addSprite(Sprite, data, 380, 390, "idle");
        sprites_to_draw[1].push( new Sprite(data, 50 ,50, "idle") );
        //sprites_to_draw[1].addSprite(Sprite, data, 280, 590, "idle");
        sprites_to_draw[2].push( new Sprite(data, 150 ,50, "idle") );

    });




    $( document ).ready(function() {
        console.log( "Page is now ready" );
        resize();

        img.onload = function() {
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = 'imgs/bk.jpg';
        draw_loop_timeout = setInterval(draw_loop, 33);
    });

    window.addEventListener('resize', resize);

    function draw_loop(){
        var background_length  = sprites_to_draw[0].length;        
        var forground_length  = sprites_to_draw[1].length;
        var sprite_c  = sprites_to_draw[2].length;

        var has_background_changed = false;

        for(var i = 0; i < background_length; i++){
            sprites_to_draw[0][i].draw( { 'has_background_changed' : has_background_changed,
                                          'key_change' : key_change
                                        }
            );
        }
        
        for(var i = 0; i < forground_length; i++){
            sprites_to_draw[1][i].draw( { 'has_background_changed' : has_background_changed,
                                          'key_change' : key_change
                                        }
            );
            
        }
        for(var i = 0; i < sprite_c; i++){
            sprites_to_draw[2][i].draw( { 'has_background_changed' : has_background_changed,
                                          'key_change' : key_change
                                        }
            );
            
        }
                //ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    }

    function resize(){
        canvas.width = window.innerWidth - 5;
        canvas.height = window.innerHeight  - 5;

    }

</script>

</body>
</html>

